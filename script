#To Install Module during First run
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force -Confirm:$false
Start-Sleep -Seconds 5
Set-PSRepository 'PSGallery' -InstallationPolicy Trusted
Install-Module PSWindowsUpdate -MinimumVersion 2.1.1.2 -Confirm:$false
Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Force -Confirm:$false
Import-Module 'PSWindowsUpdate'

$adapters = Get-WmiObject Win32_NetworkAdapterConfiguration -Filter "IPEnabled = 'True'"
$adapters.SetDynamicDNSRegistration($true,$true)
ipconfig /flushdns
ipconfig /registerdns
Start-Sleep -Seconds 300
$adapters.SetDynamicDNSRegistration($true,$false)
ipconfig /flushdns
ipconfig /registerdns
Exit


